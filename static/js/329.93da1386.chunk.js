"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[329],{4594:function(e,t,n){n.r(t),n.d(t,{default:function(){return Le}});var o,a=n(1413),r=n(4942),i=n(7313),c=n(7912),s=(n(3331),n(7458)),u=n(4778),l=n(6159),d=n(8303),p=n(3830),g=n(1639),m=n(8295),f=n(2481),h=n(3265),x=n(8564),b=n(7440),Z=n(1113),v=n(444),_=n(7829),j=n(8119),k=n(7131),y=n(9099),w=n(9289),S=n(4511),T=n(5823),C=n(647),N=n(9439),W=function(){var e=(0,i.useState)({}),t=(0,N.Z)(e,2),n=t[0],o=t[1];return(0,i.useEffect)((function(){var e=!0,t=function(){return"prerendering"===navigator.userAgent?(o({}),new Promise((function(e){return e([])}))):fetch("https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=warnsum&lang=en").then((function(e){return e.json()})).then((function(t){e&&o(t)}))},n=setInterval((function(){t()}),3e4);return t(),function(){e=!1,clearInterval(n)}}),[o]),n},I=["TC10","TC9","TC8SW","TC8NW","TC8SE","TC8NE","WRAINB","WRAINR","TC3","TC1","WRAINA","WL","WTS","WFNTSA","WHOT","WCOLD","WMSGNL"],R={TC10:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/No._10_Hurricane_Signal.png/30px-No._10_Hurricane_Signal.png",TC9:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/No._09_Increasing_Gale_or_Storm_Signal.png/30px-No._09_Increasing_Gale_or_Storm_Signal.png",TC8SW:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/No._8_Southwest_Gale_or_Storm_Signal.png/30px-No._8_Southwest_Gale_or_Storm_Signal.png",TC8NW:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/No._8_Northwest_Gale_or_Storm_Signal.png/30px-No._8_Northwest_Gale_or_Storm_Signal.png",TC8SE:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/No._8_Southeast_Gale_or_Storm_Signal.png/30px-No._8_Southeast_Gale_or_Storm_Signal.png",TC8NE:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/No._8_Northeast_Gale_or_Storm_Signal.png/30px-No._8_Northeast_Gale_or_Storm_Signal.png",WRAINB:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/Black_Rainstorm_Signal.png/25px-Black_Rainstorm_Signal.png",WRAINR:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Red_Rainstorm_Signal.png/25px-Red_Rainstorm_Signal.png",TC3:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/No._03_Strong_Wind_Signal.png/30px-No._03_Strong_Wind_Signal.png",TC1:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/No._01_Standby_Signal.png/30px-No._01_Standby_Signal.png",WRAINA:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Amber_Rainstorm_Signal.png/25px-Amber_Rainstorm_Signal.png",WL:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Landslip.gif/25px-Landslip.gif",WTS:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Thunderstorm_Warning.png/25px-Thunderstorm_Warning.png",WFNTSA:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Ntfl.gif/25px-Ntfl.gif",WHOT:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Very_Hot_Weather_Warning.png/25px-Very_Hot_Weather_Warning.png",WCOLD:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Cold_Weather_Warning.png/25px-Cold_Weather_Warning.png",WMSGNL:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/HK_Monsoon_Signal.png/25px-HK_Monsoon_Signal.png"},P=n(6417),A=function(){var e=(0,i.useContext)(b.Z),t=e.searchRoute,n=e.setSearchRoute,o=e.db.routeList,a=e.colorMode,r=e.vibrateDuration,c=e.geoPermission,s=e.updateGeolocation,u=(0,p.$B)().path,l=(0,S.$)(),g=l.t,m=l.i18n,f=(0,p.TH)(),h=(0,p.k6)(),x=function(){var e=W();return Object.values(e).map((function(e){return e.code})).filter((function(e){return I.indexOf(e)>=0})).sort((function(e,t){return I.indexOf(e)<I.indexOf(t)?-1:1}))}(),w=(0,i.useCallback)((function(){try{navigator.geolocation.getCurrentPosition((function(e){var t=e.coords,n=t.latitude,o=t.longitude;s({lat:n,lng:o})}))}catch(e){console.log("error in getting location")}}),[s]),N=(0,i.useCallback)((function(e){var o=e.key,a=e.ctrlKey,r=e.altKey,i=e.metaKey,c=e.target;a||r||i||"INPUT"!==c.tagName.toUpperCase()&&"TEXTAREA"!==c.tagName.toUpperCase()&&("Escape"===o?n(""):"Backspace"===o?n(t.slice(0,-1)):1===o.length&&(n(t+o),h.replace("/".concat(m.language,"/board"))))}),[t,m.language,n]);return(0,i.useEffect)((function(){return window.addEventListener("keydown",N),function(){window.removeEventListener("keydown",N)}}),[N]),(0,i.useMemo)((function(){return(0,P.jsxs)(H,{className:E.toolbar,children:[(0,P.jsx)(d.rU,{to:"/".concat(m.language,"/board"),onClick:function(e){e.preventDefault(),(0,T.tp)(r),h.push("/".concat(m.language,"/board"))},rel:"nofollow",children:(0,P.jsx)(Z.Z,{component:"h1",variant:"subtitle2",className:E.appTitle,children:g("\u5df4\u58eb\u5230\u7ad9\u9810\u5831")})}),(0,P.jsx)(v.Z,{id:"searchInput",className:E.searchRouteInput,type:"text",value:t,placeholder:g("\u5df4\u58eb\u7dda"),onChange:function(e){(e.target.value.toUpperCase()in o||e.target.value in o)&&(document.activeElement.blur(),h.push("/".concat(m.language,"/route/").concat(e.target.value))),n(e.target.value)},onFocus:function(e){(0,T.tp)(r),"prerendering"!==navigator.userAgent&&(0,T.z4)()&&document.activeElement.blur(),h.replace("/".concat(m.language,"/board"))},disabled:u.includes("route")}),(0,P.jsxs)(_.Z,{className:E.funcPanel,children:[x.slice(0,2).map((function(e){return(0,P.jsx)(j.Z,{variant:"square",src:R[e],sx:{height:24,width:24,m:1}},e)})),"granted"===c&&(0,P.jsx)(k.Z,{"aria-label":"relocate",onClick:function(){return w()},children:(0,P.jsx)(C.Z,{})}),(0,P.jsx)(y.Z,{sx:M,onClick:function(){return e="zh"===m.language?"en":"zh",(0,T.tp)(r),h.replace(f.pathname.replace("/"+m.language,"/"+e)),void m.changeLanguage(e);var e},id:"lang-selector",variant:"text",disableElevation:!0,disableRipple:!0,children:"zh"!==m.language?"\u7e41":"En"})]})]})}),[t,m.language,f.pathname,a,c,r])},L="header",E={toolbar:"".concat(L,"-toolbar"),appTitle:"".concat(L,"-appTitle"),searchRouteInput:"".concat(L,"-searchRouteInput"),funcPanel:"".concat(L,"-funcPanel")},H=(0,x.ZP)(w.Z)((function(e){var t,n=e.theme;return t={},(0,r.Z)(t,"& .".concat(E.appTitle),{color:"dark"===n.palette.mode?n.palette.primary.main:n.palette.text.primary}),(0,r.Z)(t,"&.".concat(E.toolbar),{backgroundColor:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,"& a":{color:"black",textDecoration:"none"},display:"flex",justifyContent:"space-between"}),(0,r.Z)(t,"& .".concat(E.searchRouteInput),{maxWidth:"100px","& input":{textAlign:"center"},"& input::before":{borderBottom:"1px ".concat(n.palette.text.primary," solid")}}),(0,r.Z)(t,"& .".concat(E.funcPanel),{display:"flex",alignItems:"center"}),t})),M={color:function(e){return e.palette.text.primary},minWidth:"40px",p:1,borderRadius:5,fontWeight:900,textTransform:"none"},D=n(9237),O=n(9856),$=n(5919),F=n(7983),G=n(180),z=n(4737),B=n(2495),U=function(){var e=(0,S.$)(),t=e.t,n=e.i18n,o=(0,p.TH)(),a=(0,i.useContext)(b.Z),r=a.selectedRoute,c=a.colorMode,s=a.vibrateDuration,u=(0,p.k6)(),l=function(e,t){t.preventDefault(),(0,T.tp)(s),setTimeout((function(){return u.push(e)}),0)};return(0,i.useMemo)((function(){return(0,P.jsxs)(V,{value:o.pathname.replace(/(.*)\/[0-9]*?$/,"$1"),showLabels:!0,classes:{root:q.root},children:[(0,P.jsx)(D.Z,{label:t("\u9996\u9801"),component:d.rU,to:"/".concat(n.language),onClick:function(e){return l("/".concat(n.language),e)},value:"/".concat(n.language),icon:(0,P.jsx)($.Z,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),(0,P.jsx)(D.Z,{label:t("\u641c\u5c0b"),component:d.rU,to:"/".concat(n.language,"/board"),onClick:function(e){return l("/".concat(n.language,"/board"),e)},value:"/".concat(n.language,"/board"),icon:(0,P.jsx)(F.Z,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),(0,P.jsx)(D.Z,{label:r.split("-")[0],component:d.rU,to:"/".concat(n.language,"/route/").concat(r.replace(/(.*)\/.*$/,"$1").toLowerCase()),onClick:function(e){return l("/".concat(n.language,"/route/").concat(r.toLowerCase()),e)},value:"/".concat(n.language,"/route/").concat(r.replace(/(.*)\/.*$/,"$1").toLowerCase()),icon:(0,P.jsx)(z.Z,{}),style:{textTransform:"uppercase"},classes:{root:"footer-actionItem",selected:"footer-selected"}}),(0,P.jsx)(D.Z,{label:t("\u898f\u5283"),component:d.rU,to:"/".concat(n.language,"/search"),onClick:function(e){return l("/".concat(n.language,"/search"),e)},value:"/".concat(n.language,"/search"),icon:(0,P.jsx)(G.Z,{}),classes:{root:"footer-actionItem",selected:"footer-selected"}}),(0,P.jsx)(D.Z,{label:t("\u8a2d\u5b9a"),component:d.rU,to:"/".concat(n.language,"/settings"),rel:"nofollow",onClick:function(e){return l("/".concat(n.language,"/settings"),e)},value:"/".concat(n.language,"/settings"),icon:(0,P.jsx)(B.Z,{}),classes:{root:"footer-actionItem",selected:q.selected}})]})}),[o.pathname,n.language,c,r,s])},K="footer",q={root:"".concat(K,"-root"),selected:"".concat(K,"-selected")},V=(0,x.ZP)(O.Z)((function(e){var t,n=e.theme;return(0,r.Z)({},"&.".concat(q.root),(t={background:"dark"===n.palette.mode?n.palette.background.default:n.palette.primary.main,position:"sticky",bottom:"0",height:"initial"},(0,r.Z)(t,"& .MuiBottomNavigationAction-root",{width:"20%",minWidth:0}),(0,r.Z)(t,"& .MuiBottomNavigationAction-label",{fontSize:"0.875rem"}),(0,r.Z)(t,"& .Mui-selected.".concat(q.selected),{color:"dark"===n.palette.mode?n.palette.primary.main:n.palette.text.primary}),t))})),Y=n(2295),X=n(282),J=n(936),Q=n.n(J),ee=n(8485),te=n(5280),ne=n(9622),oe=n(6584),ae=n(5943),re=function(e){var t=e.homeTab,n=e.onChangeTab,o=(0,S.$)().t;return(0,P.jsxs)(ee.Z,{value:t,onChange:function(e,t){return n(t,!0)},sx:ie,children:[(0,P.jsx)(te.Z,{iconPosition:"start",icon:(0,P.jsx)(ne.Z,{}),label:o("\u7d9c\u5408"),value:"both",disableRipple:!0}),(0,P.jsx)(te.Z,{iconPosition:"start",icon:(0,P.jsx)(oe.Z,{}),label:o("\u5e38\u7528"),value:"saved",disableRipple:!0}),(0,P.jsx)(te.Z,{iconPosition:"start",icon:(0,P.jsx)(ae.Z,{}),label:o("\u9644\u8fd1"),value:"nearby",disableRipple:!0})]})},ie=(o={background:function(e){return e.palette.background.default},minHeight:"36px"},(0,r.Z)(o,"& .MuiTab-root",(0,r.Z)({alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px"},"&.Mui-selected",{color:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}})),(0,r.Z)(o,"& .MuiTabs-flexContainer",{justifyContent:"center"}),(0,r.Z)(o,"& .MuiTabs-indicator",{backgroundColor:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}}),o),ce=n(4183),se=n(3405),ue=n(3428),le=function(){var e=(0,S.$)().t,t=W();return"prerendering"!==navigator.userAgent&&t&&(t.WTCSGNL&&de.includes(t.WTCSGNL.code)||t.WRAIN&&pe.includes(t.WRAIN.code))?(0,P.jsx)(me,{variant:"outlined",className:ge.card,children:(0,P.jsx)(ce.Z,{href:e("bad-weather-link"),target:"_blank",children:(0,P.jsx)(se.Z,{children:(0,P.jsx)(Z.Z,{children:e("bad-weather-text")})})})}):null},de=["TC8NE","TC8SE","TC8NW","TC8SW","TC9","TC10"],pe=["WARINR","WRAINB"],ge={card:"".concat("route","-card")},me=(0,x.ZP)(ue.Z)((function(e){var t=e.theme;return(0,r.Z)({},"&.".concat(ge.card),{borderRadius:t.shape.borderRadius,margin:.2})})),fe=n(3433),he=n(2547),xe=n(8310),be=n(3135),Ze=n(1660),ve=i.forwardRef((function(e,t){var n=e.geolocation,o=e.homeTab,c=e.onChangeTab,s=(0,i.useContext)(b.Z),u=s.hotRoute,l=s.savedEtas,d=s.db,p=d.holidays,g=d.routeList,m=d.stopList,f=s.isRouteFilter,h=(0,i.useMemo)((function(){return(0,be.HD)(p,new Date)}),[p]),x=(0,i.useRef)(o);(0,i.useImperativeHandle)(t,(function(){return{changeTab:function(e){x.current=e}}}));var Z=(0,i.useMemo)((function(){return["both","saved","nearby"].reduce((function(e,t){return(0,a.Z)((0,a.Z)({},e),{},(0,r.Z)({},t,je({geolocation:n,hotRoute:u,savedEtas:l,routeList:g,stopList:m,isRouteFilter:f,isTodayHoliday:h,homeTab:t})))}),{})}),[n]),v=(0,i.useMemo)((function(){return(0,P.jsx)(xe.Z,{disablePadding:!0,children:Z.both.split("|").map((function(e,t){return(0,P.jsx)(Ze.Z,{routeId:e},"route-shortcut-".concat(t))}))})}),[Z]),_=(0,i.useMemo)((function(){return(0,P.jsx)(xe.Z,{disablePadding:!0,children:Z.saved.split("|").map((function(e,t){return(0,P.jsx)(Ze.Z,{routeId:e},"route-shortcut-".concat(t))}))})}),[Z]),j=(0,i.useMemo)((function(){return(0,P.jsx)(xe.Z,{disablePadding:!0,children:Z.nearby.split("|").map((function(e,t){return(0,P.jsx)(Ze.Z,{routeId:e},"route-shortcut-".concat(t))}))})}),[Z]);return(0,i.useMemo)((function(){return(0,P.jsxs)(he.ZP,{index:_e.indexOf(x.current),onChangeIndex:function(e){c(_e[e])},children:[v,_,j]})}),[c,v,_,j])})),_e=["both","saved","nearby"],je=function(e){var t=e.hotRoute,n=e.savedEtas,o=e.geolocation,a=e.stopList,r=e.routeList,i=e.isRouteFilter,c=e.isTodayHoliday,s=e.homeTab,u=n.concat(Object.entries(t).filter((function(e){var t=(0,N.Z)(e,2);t[0];return t[1]>5})).sort((function(e,t){return t[1]-e[1]})).map((function(e){return(0,N.Z)(e,1)[0]}))).filter((function(e,t,n){return n.indexOf(e)===t&&e.split("/")[0]in r})).map((function(e){var t=e.split("/"),n=(0,N.Z)(t,2),i=n[0],c=n[1],s=a[Object.values(r[i].stops).sort((function(e,t){return t.length-e.length}))[0][c]];return[e,(0,T.Sp)(o,s.location)]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]})).slice(0,20),l=Object.entries(a).map((function(e){return[].concat((0,fe.Z)(e),[(0,T.Sp)(e[1].location,o)])})).filter((function(e){return e[2]<1e3})).sort((function(e,t){return e[2]-t[2]})).slice(0,5).reduce((function(e,t){var n=(0,N.Z)(t,1)[0],o=[];return Object.entries(r).forEach((function(e){var t=(0,N.Z)(e,2),a=t[0],r=t[1];["kmb","nwfb","ctb","nlb"].forEach((function(e){r.stops[e]&&r.stops[e].includes(n)&&o.push(a+"/"+r.stops[e].indexOf(n))}))})),e.concat(o)}),[]);return[].concat("nearby"!==s?u:[]).concat("saved"!==s?l:[]).filter((function(e,t,n){return n.indexOf(e)===t})).filter((function(e){var t=e.split("/"),n=(0,N.Z)(t,1)[0];return!i||(0,be.x4)(n,r[n].freq,c)})).concat(Array(20).fill("")).slice(0,20).join("|")},ke=function(){var e,t=(0,i.useContext)(b.Z),n=t.AppTitle,o=t.geolocation,a=(0,S.$)(),r=a.t,c=a.i18n,s=(0,i.useRef)(null),u=localStorage.getItem("homeTab"),l=(0,i.useState)("both"===(e=u)||"saved"===e||"nearby"===e?u:"both"),d=(0,N.Z)(l,2),p=d[0],g=d[1];(0,i.useEffect)((function(){(0,T.ND)({title:"".concat(r("Dashboard")," - ").concat(r(n)),description:r("home-page-description"),lang:c.language})}),[c.language]);var m=(0,i.useState)(o),f=(0,N.Z)(m,2),h=f[0],x=f[1],v=(0,i.useRef)(Q()((function(){console.log("update location",o),x(o)}),1e3)).current;(0,i.useEffect)((function(){v(o)}),[o]);var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g(e),localStorage.setItem("homeTab",e),s.current&&t&&s.current.changeTab(e)};return(0,P.jsxs)(Se,{className:we.root,square:!0,elevation:0,children:[(0,P.jsx)(Z.Z,{component:"h1",style:X.Z,children:"".concat(r("Dashboard")," - ").concat(r(n))}),(0,P.jsx)(Z.Z,{component:"h2",style:X.Z,children:r("home-page-description")}),(0,P.jsx)(re,{homeTab:p,onChangeTab:_}),(0,P.jsx)(le,{}),(0,P.jsx)(ve,{ref:s,homeTab:p,geolocation:h,onChangeTab:_})]})},ye="home",we={root:"".concat(ye,"-root"),tabbar:"".concat(ye,"-tabbar")},Se=(0,x.ZP)(Y.Z)((function(e){var t=e.theme;return(0,r.Z)({},"&.".concat(we.root),{background:"dark"===t.palette.mode?t.palette.background.default:"white",height:"calc(100vh - 125px)",overflowY:"scroll",textAlign:"center"})})),Te=n(5640),Ce=(0,c.ZP)((function(){return Promise.all([n.e(355),n.e(165),n.e(414),n.e(890)]).then(n.bind(n,7890))})),Ne=(0,c.ZP)((function(){return Promise.all([n.e(630),n.e(105)]).then(n.bind(n,2105))})),We=(0,c.ZP)((function(){return Promise.all([n.e(149),n.e(165),n.e(978),n.e(635)]).then(n.bind(n,1635))})),Ie=(0,c.ZP)((function(){return Promise.all([n.e(355),n.e(944)]).then(n.bind(n,2630))})),Re=(0,c.ZP)((function(){return n.e(370).then(n.bind(n,3370))})),Pe=(0,c.ZP)((function(){return n.e(481).then(n.bind(n,7481))})),Ae=function(){var e=(0,p.$B)().path;return(0,P.jsx)(Te.N,{children:(0,P.jsxs)(p.rs,{children:[(0,P.jsx)(p.AW,{path:"".concat(e,"/route/:id/:panel?"),component:Ce}),(0,P.jsx)(p.AW,{path:"".concat(e,"/settings"),component:Ie}),(0,P.jsx)(p.AW,{path:"".concat(e,"/board"),component:Ne}),(0,P.jsx)(p.AW,{path:"".concat(e,"/search"),component:We}),(0,P.jsx)(p.AW,{path:"".concat(e,"/privacy"),component:Re}),(0,P.jsx)(p.AW,{path:"".concat(e,"/terms"),component:Pe}),(0,P.jsx)(p.AW,{path:"".concat(e),component:ke})]})})},Le=function(){var e=(0,i.useContext)(b.Z).colorMode,t=(0,i.useMemo)((function(){return(0,s.Z)(De(e),[e])}),[e]);return(0,P.jsx)(u.Z,{injectFirst:!0,children:(0,P.jsx)(l.Z,{theme:t,children:(0,P.jsx)(g.C,{value:Me,children:(0,P.jsx)(He,{maxWidth:"xs",disableGutters:!0,className:Ee.container,children:(0,P.jsxs)(d.VK,{children:[(0,P.jsx)(p.AW,{exact:!0,path:"/",children:(0,P.jsx)(p.l_,{to:"/zh"})}),(0,P.jsxs)(p.AW,{path:"/:lang",children:[(0,P.jsx)(f.ZP,{}),(0,P.jsx)(A,{}),(0,P.jsx)(Ae,{}),(0,P.jsx)(U,{})]})]})})})})})},Ee={container:"".concat("app","-container")},He=(0,x.ZP)(h.Z)((function(e){e.theme;return(0,r.Z)({},"&.".concat(Ee.container),{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"})})),Me=(0,m.Z)({key:"hkbus",speedy:!("prerendering"===navigator.userAgent)}),De=function(e){return{typography:{fontFamily:"'Chiron Sans HK Pro WS', sans-serif"},palette:(0,a.Z)({mode:e},"light"===e?{background:{default:"#fedb00"},primary:{main:"#fedb00"}}:{primary:{main:"#fedb00"},background:{default:"#000"}}),components:{MuiCssBaseline:{styleOverrides:{html:{userSelect:"none"},body:{fontSize:"0.875rem",lineHeight:1.43}}}}}}},5640:function(e,t,n){n.d(t,{N:function(){return c}});var o=n(9439),a=n(7313),r=n(6417),i=a.createContext({}),c=function(e){var t=(0,a.useState)({start:null,end:null}),n=(0,o.Z)(t,2),c=n[0],s=n[1],u=(0,a.useState)("ready"),l=(0,o.Z)(u,2),d=l[0],p=l[1],g=(0,a.useState)([]),m=(0,o.Z)(g,2),f=m[0],h=m[1],x=(0,a.useState)({resultIdx:0,stopIdx:[0,0]}),b=(0,o.Z)(x,2),Z=b[0],v=b[1];return(0,r.jsx)(i.Provider,{value:{locations:c,setLocations:s,status:d,setStatus:p,result:f,setResult:h,resultIdx:Z,setResultIdx:v},children:e.children})};t.Z=i},9878:function(e,t,n){n.d(t,{e:function(){return u}});var o=n(1413),a=n(9439),r=n(7313),i=n(4511),c=n(7420),s=n(7440),u=function(e){var t=(0,r.useContext)(s.Z),n=t.db.routeList,u=t.isVisible,d=e.split("/"),p=(0,a.Z)(d,2),g=p[0],m=p[1],f=n[g]||l,h=(0,r.useState)(null),x=(0,a.Z)(h,2),b=x[0],Z=x[1],v=(0,i.$)().i18n.language;return(0,r.useEffect)((function(){var e=!0,t=function(){return u&&"prerendering"!==navigator.userAgent?(0,c.fetchEtas)((0,o.Z)((0,o.Z)({},f),{},{seq:parseInt(m,10),language:v})).then((function(t){e&&Z(t)})):(Z(null),new Promise((function(e){return e([])})))},n=setInterval((function(){t()}),3e4);return t(),function(){e=!1,clearInterval(n)}}),[e,u]),b},l={co:[""],stops:{"":[""]},dest:{zh:"",en:""},bound:"",nlbId:0,gtfsId:"",fares:[],faresHoliday:[]}},1660:function(e,t,n){n.d(t,{Z:function(){return S}});var o=n(4942),a=n(9439),r=n(7313),i=n(9282),c=n(1113),s=n(4313),u=n(527),l=n(8303),d=n(3830),p=n(5823),g=n(8564),m=n(7440),f=n(4511),h=n(9878),x=n(6417),b=function(e){var t=e.routeId,n=(0,f.$)(),o=n.t,a=n.i18n,i=(0,r.useContext)(m.Z).etaFormat,s=(0,h.e)(t),u=function(e){if(!e||!e.eta)return"";var t=Math.round((new Date(e.eta).getTime()-(new Date).getTime())/60/1e3);if(!Number.isInteger(t))return e.remark[a.language];var n=e.eta.slice(11,16),r=t<1?"- ".concat(o("\u5206\u9418")):"".concat(t," ").concat(o("\u5206\u9418"));switch(i){case"exact":return n;case"diff":return r;default:return"".concat(n," (").concat(r,")")}};return(0,x.jsx)(_,{primary:(0,x.jsx)(c.Z,{component:"h5",color:"textPrimary",children:s?u(s[0]):""}),secondary:(0,x.jsxs)(c.Z,{variant:"h6",color:"textSecondary",className:v.secondary,children:[s?u(s[1]):"",(0,x.jsx)("br",{}),s?u(s[2]):""]}),className:v.root})},Z="etas",v={root:"".concat(Z,"-root"),secondary:"".concat(Z,"-secondary")},_=(0,g.ZP)(i.Z)((function(e){var t;e.theme;return t={},(0,o.Z)(t,"&.".concat(v.root),{width:"25%",textAlign:"right"}),(0,o.Z)(t,"& .".concat(v.secondary),{fontSize:"0.875rem",fontWeight:"400",lineHeight:"1.43"}),t})),j=n(9530),k=function(e){var t=e.name,n=e.location,o=e.fares,a=e.faresHoliday,i=e.seq,c=(0,f.$)().t,s=(0,r.useContext)(m.Z),u=s.geoPermission,l=s.geolocation,d=[o&&o[i]?"$"+o[i]:"",a&&a[i]?"$"+a[i]:""].filter((function(e){return e})).join(", ");return"granted"!==u||0===n.lat?(0,x.jsx)(x.Fragment,{children:t+"\u3000"+(d?"("+d+")":"")}):(0,x.jsx)(x.Fragment,{children:t+" - "+(0,p.Sp)(n,l).toFixed(0)+c("\u7c73")+"\u3000"+(d?"("+d+")":"")})},y={co:[""],stops:{"":[""]},dest:{zh:"",en:""},bound:"",nlbId:0,fares:[],faresHoliday:[]},w={location:{lat:0,lng:0},name:{zh:"",en:""}},S=function(e){var t=e.routeId,n=(0,f.$)(),o=n.t,u=n.i18n,g=(0,r.useContext)(m.Z),h=g.db,Z=h.routeList,v=h.stopList,_=g.vibrateDuration,S=t.split("-"),C=(0,a.Z)(S,1)[0],I=t.split("/"),R=(0,a.Z)(I,2),P=R[0],A=R[1],L=Z[P]||y,E=L.co,H=L.stops,M=L.dest,D=L.fares,O=L.faresHoliday,$=v[T(E,H)[parseInt(A,10)]]||w,F=(0,d.k6)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(W,{component:l.rU,to:"/".concat(u.language,"/route/").concat(P.toLowerCase()),onClick:function(e){e.preventDefault(),(0,p.tp)(_),setTimeout((function(){F.push("/".concat(u.language,"/route/").concat(t.toLowerCase()))}),0)},className:N.listItem,children:[(0,x.jsx)(i.Z,{primary:(0,x.jsx)(j.Z,{routeNo:C}),className:N.route}),(0,x.jsx)(i.Z,{primary:(0,x.jsxs)(c.Z,{component:"h3",variant:"body1",color:"textPrimary",className:N.fromToWrapper,children:[(0,x.jsx)("span",{className:N.fromToText,children:o("\u5f80")}),(0,x.jsx)("b",{children:(0,p.iF)(M[u.language])})]}),secondary:(0,x.jsx)(k,{name:(0,p.iF)($.name[u.language]),location:$.location,fares:D,faresHoliday:O,seq:parseInt(A,10)}),secondaryTypographyProps:{component:"h4",variant:"subtitle2"},className:N.routeDest}),(0,x.jsx)(b,{routeId:t})]}),(0,x.jsx)(s.Z,{})]})},T=function(e,t){for(var n=0;n<e.length;++n)if(e[n]in t)return t[e[n]]},C="succinctTimeReport",N={listItem:"".concat(C,"-listItem"),route:"".concat(C,"-route"),routeDest:"".concat(C,"-routeDest"),fromToWrapper:"".concat(C,"-fromToWrapper"),fromToText:"".concat(C,"-fromToText")},W=(0,g.ZP)(u.ZP)((function(e){var t,n=e.theme;return t={},(0,o.Z)(t,"&.".concat(N.listItem),{padding:"4px 16px",color:"rgba(0,0,0,0.87)"}),(0,o.Z)(t,"& .".concat(N.route),{width:"15%"}),(0,o.Z)(t,"& .".concat(N.routeDest),{width:"50%",whiteSpace:"nowrap",overflow:"hidden"}),(0,o.Z)(t,"& .".concat(N.fromToWrapper),{display:"flex",alignItems:"baseline",fontSize:"1.2rem"}),(0,o.Z)(t,"& .".concat(N.fromToText),{fontSize:"0.85rem",marginRight:n.spacing(.5)}),t}))},9530:function(e,t,n){var o=n(4942),a=n(9439),r=(n(7313),n(1113)),i=n(8564),c=n(6417);t.Z=function(e){var t=e.routeNo,n=e.component,o=e.align,r=t.match(/[A-Z]+$/)?[t.slice(0,-1),t.slice(-1)]:[t,""],i=(0,a.Z)(r,2),s=i[0],d=i[1];return(0,c.jsxs)(l,{component:n||"h2",align:o,variant:"caption",color:"textPrimary",className:u.root,children:[(0,c.jsx)("span",{className:u.prefix,children:s}),(0,c.jsx)("span",{className:u.suffix,children:d})]})};var s="routeNo",u={root:"".concat(s,"-root"),prefix:"".concat(s,"-prefix"),suffix:"".concat(s,"-suffix")},l=(0,i.ZP)(r.Z)((function(e){var t;e.theme;return t={},(0,o.Z)(t,"&.".concat(u.root),{lineHeight:"normal",display:"inline"}),(0,o.Z)(t,"& .".concat(u.prefix),{fontSize:"1.5rem",fontFamily:'"Oswald", sans-serif'}),(0,o.Z)(t,"& .".concat(u.suffix),{fontSize:"1.2rem",fontFamily:'"Oswald", sans-serif'}),t}))},3135:function(e,t,n){n.d(t,{HD:function(){return i},x4:function(){return c}});var o=n(9439),a={266:[0,0,1,1,1,0,0],271:[0,1,1,1,1,0,0],272:[0,0,0,0,0,1,0],287:[0,1,1,1,1,1,0],288:[0,0,0,0,0,0,1],319:[0,1,1,1,1,1,1],320:[1,0,0,0,0,0,0],415:[0,1,1,1,1,1,0],416:[1,0,0,0,0,0,1],447:[0,1,1,1,1,1,1],448:[1,0,0,0,0,0,0],480:[1,0,0,0,0,0,1],511:[1,1,1,1,1,1,1],31:[0,1,1,1,1,1,0],63:[0,1,1,1,1,1,1],111:[1,1,0,1,1,1,1]},r=function(e,t){var n=24*e*60;return n+=60*parseInt(t.slice(0,2),10)+parseInt(t.slice(2),10)},i=function(e,t){return e.includes("".concat(t.getFullYear()).concat(("0"+(t.getMonth()+1)).slice(-2)).concat(("0"+t.getDate()).slice(-2)))},c=function(e,t,n){if(!t)return!0;var i=!1,c=new Date,s=r(n?0:c.getDay(),("0"+c.getHours()).slice(-2)+("0"+c.getMinutes()).slice(-2));return Object.entries(t).forEach((function(t){var n=(0,o.Z)(t,2),c=n[0],u=n[1];try{a[c].forEach((function(e,t){e&&Object.entries(u).forEach((function(e){var n,a,c,u=(0,o.Z)(e,2),l=u[0],d=u[1],p=r(t,l),g=r(t,d?d[0]:l);i=i||(a=g,(n=p)-60<=(c=s)&&c<=a+60||n-60<=c+10080&&c+10080<=a+60)}))}))}catch(l){console.log(e+" has unknown service ID")}})),i}}}]);