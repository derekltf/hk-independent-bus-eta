"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[105],{2105:function(e,n,t){t.r(n),t.d(n,{default:function(){return ie}});var r,a,o=t(9439),i=t(7313),c=t(7440),l=t(7829),s=t(4942),u=t(9099),d=t(9019),p=t(8564),f=t(2720),h=t(4511),x=t(9563),m=t(6417),b=function(e){var n=e.k,t=e.handleClick,r=e.disabled,a=void 0!==r&&r,o=e.className,i=(0,h.$)().t;return(0,m.jsx)(u.Z,{size:"large",variant:"contained",className:"".concat(C.button," ").concat(o),onClick:function(){return t(n)},disabled:a,disableRipple:!0,children:"b"===n?(0,m.jsx)(f.Z,{}):"c"===n?(0,m.jsx)("div",{className:C.cancel,children:i("C")}):n})},g=function(e){var n=e.possibleChar,t=(0,i.useContext)(c.Z),r=t.searchRoute,a=t.updateSearchRouteByButton;return(0,m.jsx)(d.ZP,{container:!0,spacing:0,children:"789456123c0b".split("").map((function(e){return(0,m.jsx)(d.ZP,{item:!0,xs:4,children:(0,m.jsx)(b,{k:e,handleClick:a,className:C.number,disabled:"b"===e&&""===r||!"bc".includes(e)&&!n.includes(e)||"c"===e&&""===r})},"input-"+e)}))})},Z=function(e){var n=e.possibleChar,t=(0,i.useContext)(c.Z).updateSearchRouteByButton;return(0,m.jsx)(d.ZP,{container:!0,spacing:1,children:n.filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return(0,m.jsx)(d.ZP,{item:!0,xs:12,children:(0,m.jsx)(b,{k:e,handleClick:t,className:C.alphabet})},"input-"+e)}))})},j=function(e){var n=e.boardTab,t=(0,i.useContext)(c.Z),r=t.searchRoute,a=t.db.routeList,o=k(r,a,n);return"prerendering"===navigator.userAgent?(0,m.jsx)(m.Fragment,{}):(0,m.jsxs)(T,{className:C.root,padding:0,children:[(0,m.jsx)(l.Z,{className:C.numPadContainer,padding:0,children:(0,m.jsx)(g,{possibleChar:o})}),(0,m.jsx)(l.Z,{className:C.alphabetPadContainer,padding:0,children:(0,m.jsx)(Z,{possibleChar:o})})]})},v="inputpad",C={root:"".concat(v,"-boxContainer"),numPadContainer:"".concat(v,"-numPadContainer"),alphabetPadContainer:"".concat(v,"-alphabetPadContainer"),button:"".concat(v,"-button"),alphabet:"".concat(v,"-alphabet"),cancel:"".concat(v,"-cancel"),number:"".concat(v,"-number")},T=(0,p.ZP)(l.Z)((function(e){var n,t=e.theme;return n={},(0,s.Z)(n,"&.".concat(C.root),{zIndex:0,background:t.palette.background.default,display:"flex",flexDirection:"row",height:"248px",justifyContent:"space-around",paddingTop:"8px"}),(0,s.Z)(n,"& .".concat(C.numPadContainer),{width:"72%"}),(0,s.Z)(n,"& .".concat(C.alphabetPadContainer),{width:"20%",height:"246px",overflowX:"hidden",overflowY:"scroll"}),(0,s.Z)(n,"& .".concat(C.button),{background:t.palette.background.paper,color:t.palette.text.primary,width:"100%",fontSize:"1.8em",borderRadius:"unset","&:selected":{color:t.palette.text.primary},"&:hover":{backgroundColor:t.palette.background.paper}}),(0,s.Z)(n,"& .".concat(C.cancel),{fontSize:"0.9em"}),(0,s.Z)(n,"& .".concat(C.alphabet),{height:"52px"}),(0,s.Z)(n,"& .".concat(C.number),{height:"62px"}),n})),k=function(e,n,t){if(null==n)return[];var r={};return Object.entries(n).forEach((function(n){var a=(0,o.Z)(n,2),i=a[0],c=a[1];if(i.startsWith(e.toUpperCase())&&c.co.some((function(e){return x.nR[t].includes(e)}))){var l=i.slice(e.length,e.length+1);r[l]=isNaN(r[l])?1:r[l]+1}})),Object.entries(r).map((function(e){return e[0]})).filter((function(e){return"-"!==e}))},y=t(5823),w=t(8485),N=t(5280),A=function(e){var n=e.boardTab,t=e.onChangeTab,r=(0,h.$)().t;return(0,m.jsx)(l.Z,{sx:S,children:(0,m.jsx)(w.Z,{value:n,onChange:function(e,n){return t(n,!0)},sx:R,children:Object.keys(x.nR).map((function(e){return(0,m.jsx)(N.Z,{label:r(e),value:e,disableRipple:!0},e)}))})})},R=(a={background:function(e){return e.palette.background.default},minHeight:"36px"},(0,s.Z)(a,"& .MuiTab-root",(r={paddingTop:0,paddingBottom:0,minHeight:"32px"},(0,s.Z)(r,"&.Mui-selected",{color:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}}),(0,s.Z)(r,"&.MuiButtonBase-root",{textTransform:"none"}),r)),(0,s.Z)(a,"& .MuiTabs-indicator",{backgroundColor:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}}),a),S={background:function(e){return"dark"===e.palette.mode?e.palette.background.default:"white"}},z=t(2547),I=t(275),$=t(2429),P=t(3165),L=t(4689),O=t(6912),D=t(1113),B=t(3135),W=t(4183),Y=t(3405),M=t(3428),F=t(8303),_=t(3830),E=t(9530),H=function(e){var n=e.route,t=(0,h.$)(),r=t.t,a=t.i18n;return(0,m.jsx)(D.Z,{component:"h3",variant:"body1",className:q.routeInfo,children:(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:q.fromToWrapper,children:[(0,m.jsx)("span",{className:q.fromToText,children:"".concat(r("\u5f80")," ")}),(0,m.jsx)("b",{children:(0,y.iF)(n.dest[a.language])})]}),(0,m.jsxs)("div",{className:q.fromWrapper,children:[(0,m.jsx)("span",{className:q.fromText,children:r("\u7531")}),(0,m.jsx)("span",{children:(0,y.iF)(n.orig[a.language])})]})]})})},U=i.memo((function(e){var n=e.data,t=n.routeList,r=n.vibrateDuration,a=e.index,i=e.style,c=(0,h.$)(),l=c.t,s=c.i18n,u=t[a],d=u[0].split("-").slice(0,2),p=(0,o.Z)(d,2),f=p[0],x=p[1],b=(0,_.k6)();return(0,m.jsx)(F.rU,{onClick:function(e){e.preventDefault(),(0,y.tp)(r),setTimeout((function(){b.push("/".concat(s.language,"/route/").concat(u[0].toLowerCase()))}),0)},to:"/".concat(s.language,"/route/").concat(u[0].toLowerCase()),children:(0,m.jsx)(G,{className:q.card,variant:"outlined",style:i,square:!0,children:(0,m.jsx)(W.Z,{children:(0,m.jsxs)(Y.Z,{className:q.cardContent,children:[(0,m.jsxs)("div",{className:q.busInfoContainer,children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(E.Z,{routeNo:f}),parseInt(x,10)>=2&&(0,m.jsx)(D.Z,{variant:"caption",className:q.specialTrip,children:l("\u7279\u5225\u73ed")})]}),(0,m.jsx)(D.Z,{component:"h4",variant:"caption",className:q.company,children:u[1].co.map((function(e){return l(e)})).join("+")})]}),(0,m.jsx)(H,{route:u[1]})]})})},u[0])})}),P.wy),X="routeRow",q={card:"".concat(X,"-card"),cardContent:"".concat(X,"-cardContent"),busInfoContainer:"".concat(X,"-busInfoContainer"),routeInfo:"".concat(X,"-routeInfo"),company:"".concat(X,"-company"),fromToWrapper:"".concat(X,"-fromToWrapper"),fromToText:"".concat(X,"-fromToText"),fromWrapper:"".concat(X,"-fromWrapper"),fromText:"".concat(X,"-fromText"),specialTrip:"".concat(X,"-specialTrip")},G=(0,p.ZP)(M.Z)((function(e){var n,t=e.theme;return n={},(0,s.Z)(n,"&.".concat(q.card),{background:"dark"===t.palette.mode?t.palette.background.default:"white"}),(0,s.Z)(n,"& .".concat(q.cardContent),{display:"flex",justifyContent:"flex-start",alignItems:"center",padding:"0 16px"}),(0,s.Z)(n,"& .".concat(q.busInfoContainer),{width:"25%"}),(0,s.Z)(n,"& .".concat(q.routeInfo),{textAlign:"left",fontSize:"1rem",width:"75%"}),(0,s.Z)(n,"& .".concat(q.company),{color:t.palette.text.secondary}),(0,s.Z)(n,"& .".concat(q.fromToWrapper),{display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden"}),(0,s.Z)(n,"& .".concat(q.fromToText),{fontSize:"0.95rem",marginRight:t.spacing(.5)}),(0,s.Z)(n,"& .".concat(q.fromWrapper),{display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden",fontSize:"0.75rem"}),(0,s.Z)(n,"& .".concat(q.fromText),{marginRight:t.spacing(.5)}),(0,s.Z)(n,"& .".concat(q.specialTrip),{fontSize:"0.6rem",marginLeft:"8px"}),n})),J=(0,O.Z)((function(e,n){return{routeList:e,vibrateDuration:n}})),K=(0,I.yP)((0,I.p6)(z.ZP)),Q=function(e){var n=e.boardTab,t=e.onChangeTab,r=(0,i.useContext)(c.Z),a=r.searchRoute,s=r.db,u=s.holidays,d=s.routeList,p=r.isRouteFilter,f=r.vibrateDuration,b=(0,i.useMemo)((function(){return(0,B.HD)(u,new Date)}),[u]),g=(0,h.$)().t,Z=(0,i.useMemo)((function(){var e=Object.entries(d).filter((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1],i=r.stops,c=r.co;return t.startsWith(a.toUpperCase())&&(null==i[c[0]]||i[c[0]].length>0)})).filter((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1].freq;return!p||(0,B.x4)(t,r,b)})).sort(ae);return Object.entries(x.nR).map((function(n){var t=(0,o.Z)(n,2),r=(t[0],t[1]);return J(e.filter((function(e){var n=(0,o.Z)(e,2);n[0];return n[1].co.some((function(e){return r.includes(e)}))})),f)}))}),[d,b,a,p,f]),j=(0,i.useCallback)((function(e){var n=e.key,t=e.index;return(0,m.jsx)(i.Fragment,{children:Z[t].routeList.length?(0,m.jsx)(L.Z,{children:function(e){var n=e.height,r=e.width;return(0,m.jsx)(P.t7,{height:.98*n,itemCount:Z[t].routeList.length,itemSize:56,width:r,itemData:Z[t],className:ne.root,children:U})}}):(0,m.jsxs)(l.Z,{sx:re,children:[(0,m.jsx)($.Z,{}),(0,m.jsxs)(D.Z,{variant:"h6",children:['"',a,'"']}),(0,m.jsx)(D.Z,{variant:"h6",children:g("route-search-no-result")})]})},n)}),[Z,a,g]);return(0,i.useMemo)((function(){return console.log("dump",n),(0,m.jsx)(m.Fragment,{children:"prerendering"===navigator.userAgent?(0,m.jsx)(te,{className:ne.prerenderList,children:Z[0].routeList.map((function(e,n){return(0,m.jsx)(U,{data:Z[0],index:n,style:null},"route-".concat(n))}))}):(0,m.jsx)(K,{index:V.indexOf(n),onChangeIndex:function(e){t(V[e])},style:{flex:1,display:"flex"},containerStyle:{flex:1},slideCount:Z.length,overscanSlideAfter:1,overscanSlideBefore:1,slideRenderer:j,enableMouseEvents:!0})})}),[j,Z,t,n])},V=["all","bus","minibus","lightRail","mtr"],ee="routeBoard",ne={root:"".concat(ee,"-root"),prerenderList:"".concat(ee,"-prerenderList"),noResult:"".concat(ee,"-noResult")},te=(0,p.ZP)("div")((function(e){e.theme;return(0,s.Z)({},"&.".concat(ne.prerenderList),{height:"100%",overflowY:"scroll","& a":{textDecoration:"none"}})})),re=(0,s.Z)({height:"300px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:"1rem"},"& .MuiSvgIcon-root",{fontSize:"8rem"}),ae=function(e,n){var t=e[0].split("-"),r=n[0].split("-");if(+t[0].replaceAll(/[A-z]$/gi,"")>+r[0].replaceAll(/[A-z]$/gi,""))return 1;if(+t[0].replaceAll(/[A-z]$/gi,"")<+r[0].replaceAll(/[A-z]$/gi,""))return-1;if(t[0].replaceAll(/[0-9]/gi,"")>r[0].replaceAll(/[0-9]/gi,""))return 1;if(t[0].replaceAll(/[0-9]/gi,"")<r[0].replaceAll(/[0-9]/gi,""))return-1;if(+t[0].replaceAll(/[A-z]/gi,"")>+r[0].replaceAll(/[A-z]/gi,""))return 1;if(+t[0].replaceAll(/[A-z]/gi,"")<+r[0].replaceAll(/[A-z]/gi,""))return-1;var a=e[1].co.sort((function(e,n){return x.Y$.indexOf(e)-x.Y$.indexOf(n)})),o=n[1].co.sort((function(e,n){return x.Y$.indexOf(e)-x.Y$.indexOf(n)}));return x.Y$.indexOf(a[0])>x.Y$.indexOf(o[0])?1:x.Y$.indexOf(a[0])<x.Y$.indexOf(o[0])?-1:t[1]>r[1]?1:-1},oe=function(e){var n=e.boardTab,t=e.setBoardTab,r=(0,i.useContext)(c.Z).AppTitle,a=(0,h.$)(),o=a.t,s=a.i18n;(0,i.useEffect)((function(){(0,y.ND)({title:o("\u641c\u5c0b")+" - "+o(r),description:o("route-board-page-description"),lang:s.language})}),[s.language]);var u=(0,i.useCallback)((function(e){t(e),localStorage.setItem("boardTab",e)}),[t]);return(0,m.jsxs)(l.Z,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[(0,m.jsx)(A,{boardTab:n,onChangeTab:u}),(0,m.jsx)(Q,{boardTab:n,onChangeTab:u})]})},ie=function(){var e,n=localStorage.getItem("boardTab"),t=(0,i.useState)("all"===(e=n)||"bus"===e||"minibus"===e||"lightRail"===e||"mtr"===e?n:"all"),r=(0,o.Z)(t,2),a=r[0],c=r[1];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(oe,{boardTab:a,setBoardTab:c}),(0,m.jsx)(j,{boardTab:a})]})}}}]);